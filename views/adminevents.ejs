<!DOCTYPE html>
<html>
	<head>
		<% include head_html %>
	</head>
	<body>
		<div class="wrapper">
			<h1><%= title %></h1>
			<% if(adminLogin){ %>
				<div>
				<% include admheader %>
				</div>
				<div class="col-sm-2">
					<% include admmnu %>
				</div>
				<div id="workArea" class="col-sm-10">
					Мероприятия
					<div class="wrapper">
						<div class="row">
							<button id="btnCreateEvent" value='NewEvent' type="button">Создать новое</button>
							<p id="resultCreateMsg"></p>
						</div>
						<div id="workArea" class="row">
						<% if(eventsList) { %>
							<div class="wrapper">
							<table class="table trans">
								<thead>
									<th scope="col">Афиша</th>
									<th scope="col">ID</th>
									<th scope="col">Название</th>
									<th scope="col">Дата и время</th>
									<th scope="col">Место:</th>
								</thead>
								<tbody>
							<% eventsList.forEach(function(eventRow) { %>
									<tr>
										<td scope="row">
											<a href="/admin/event/<%= eventRow.ID %>">
												<img src="<%= eventRow.ImgPath %>" width="50px" height="100px" alt="<%= eventRow.Name %>" />
											</a>
										</td>
										<td scope="row">
											<a href="/admin/event/<%= eventRow.ID %>"><span id="eventID<%= eventRow.ID %>"><%= eventRow.ID %></span></a>
										</td>
										<td>
											<a href="/admin/event/<%= eventRow.ID %>"><%= eventRow.Name %></a>
										</td>
										<td>
											<a href="/admin/event/<%= eventRow.ID %>"><%= eventRow.DateFrom %></a>
										</td>
										<td>
											<a href="/admin/event/<%= eventRow.ID %>"><%= eventRow.Stadium %></a>
										</td>
									</tr>
							<% }); %>
								</tbody>
							</table>
							</div>
						<% } %>
						</div>
					</div>
				</div>
				<script>
					$("#btnCreateEvent").click(function(){
						console.log("btnCreateEvent click");
						$("#resultCreateMsg").html('Функционал создания нового мероприятия находится в разработке');
						//--------------
						//TODO: after development this functional we must delete this command:
						//ClearMsg("#resultCreateMsg");
						//--------------
						
						$.ajax({
							url: "/admin/events/",
							type: "POST",
							data: {
								postOperation: "ins"
							},
							success: function(result){
								console.log("POST /admin/events/ success");
								console.log("result.ID="+result.ID+", ResultMsg="+result.ResultMsg);
								console.log(result);
								//$("#resultCreateMsg").html("result.ID="+result.ID);
								if(result.ID > 0){
									window.location.replace("/admin/event/"+result.ID);
								}
								else {
									$("#resultCreateMsg").html('Функционал создания нового мероприятия находится в разработке');
									ClearMsg("#resultCreateMsg");
								}
							},
							error: function(err){
								console.log("btnCreateEvent POST /admin/events/ error:");
								console.log(err);
								$("#resultCreateMsg").html('При создании нового мероприятия возникла ошибка: '+err);
								//ClearMsg("#resultCreateMsg");
							}
						});
					});
					
					function ClearMsg(msgElement){
						window.setTimeout( function(){
							$(msgElement).html("");
						}, 5000 );
					}
				</script>
			<% } else{ %>
				<% include admloginform %>
			<% } %>
		</div>
	</body>
</html>

